services:
  proxy-1:
    container_name: proxy-1
    build:
      context: ./src/proxy/base-proxy
      dockerfile: Dockerfile
    volumes:
      - ./src/proxy/base-proxy:/app
      - ./utils/handlers:/app/src/handlers
    ports:
      - "${PROXY_1_EXTERNAL_PORT}:${PROXY_PORT}"
    # The watch command will check for changes in the code and restart the server
    command: sh -c "npm run watch"
    environment:
      PORT: ${PROXY_PORT} 
      EVENT_ADDRESS: ${EVENT_HOST_SITE_1}
      EVENT_PORT: ${EVENT_PORT_SITE_1}
      EVENT_CLIENT_ID: "proxy-1"
    # depends_on:
    #   broker:
    #     condition: service_healthy
    networks:
      - site1

networks:
  site1:
    name: site1
    external: true
